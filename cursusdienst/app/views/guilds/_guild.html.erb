<div>
  <h1><%= link_to guild.name, guild %></h1>

  <% if current_user && not(current_user.guilds.include?(guild) )%>
    <%= link_to "Join this guild", join_guild_path(guild), :method => :put %>
  <% else %>
    <p>You are a member of this guild</p>
  <% end %>

  <strong>Disciplines:</strong><br>
  <% guild.disciplines.each { |discipline| %>
    <strong><%= discipline.name %></strong><br/>
    <ul>
      <li><strong>Faculty:</strong><%= link_to discipline.faculty.name, discipline.faculty %> <br/></li>
      <li><strong>Institute:</strong><%= link_to discipline.faculty.institute.name, discipline.faculty.institute %> <br/></li>
    </ul>
  <% } %>

  <h2>Supplies</h2>
  <div class="supplies" id="supplies">
    <div id="filter" style="display:none;">
      <%= form_tag update_filter_guild_path, :method => :put do %>
        <div style="display:none;">
          <%= label_tag "institute" %>
          <%= render :partial => "filters/select_box", :locals => {
            :filter_key_ajax => "institute",
            :id => "filter[institute_id]",
            :dataset => get_institutes, 
            :selected_id => guild.disciplines.first.faculty.institute_id.to_s,
            :parent_id => "filter_institute_id",
            :child_id => "filter_faculty_id"} %> <br />

          <%= label_tag "faculty" %>    
          <%= render :partial => "filters/select_box", :locals => {
            :filter_key_ajax => "faculty",
            :id => "filter[faculty_id]",
            :dataset => get_faculties(guild.disciplines.first.faculty.institute_id.to_s), 
            :selected_id => guild.disciplines.first.faculty.id.to_s,
            :parent_id => "filter_faculty_id",
            :child_id => "filtert_discipline_id"} %> <br />
        </div>

        <%= label_tag "discipline" %>    
        <%= render :partial => "filters/select_box_html_options", :locals => {
          :filter_key_ajax => "discipline",
          :id => "filter[discipline_id]",
          :dataset => get_disciplines(guild.disciplines.first.faculty.id.to_s), 
          :selected_id => @selected_discipline,
          :html_options => {:onchange => '$(filter_year_type).val("");'}} %> <br />

        <%= label_tag "Year" %>    

        <%= select_tag "filter[year_type]", 
          options_for_select([["bachelor","bachelor"], ["master","master"]], @selected_year_type), 
          {:prompt => 'select year', :onchange => "if (this.value !='') {this.form.submit();} "} %>
      <% end %>
    </div>
    <%= link_to_function "Show", "$(filter).toggle()" %>
    <ul class="supplies">
      <%= "not selling any materials" if @materials.empty?%>
      <% @materials.each do |supply| %>
        <%= render supply %>
      <% end %>
    </ul>

    
  </div>

  <h2>Messages</h2>
  <%= link_to_function "Show", "$('#messages').toggle()" %>
  <div class="messages", id="messages", style="display:none;">
       <ul class="messages">
      <% guild.messages.each do |message| %>
        <%= render message %>
      <% end %>
    </ul>
    <%= link_to "New Message", new_message_path(:guild_id => guild.id) if (current_user && current_user.can?('create_all_messages')) || (current_user && current_user.can?('create_messages') && current_user.guilds.include?(guild)) %><br/>
  </div><br/>
  <%= link_to "Edit this guild", edit_guild_path(guild) %>
</div>
